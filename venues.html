<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RCEM ‚Äì Venues</title>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#f4f6f9
}
.header{
  background:#0d47a1;
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
.container{padding:15px}

.btn{
  padding:9px 14px;
  border:none;
  border-radius:20px;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}
.add{background:linear-gradient(45deg,#2e7d32,#43a047)}
.edit{background:linear-gradient(45deg,#1976d2,#42a5f5)}
.toggle{background:linear-gradient(45deg,#f9a825,#fbc02d);color:#000}

.card{
  background:#fff;
  padding:15px;
  border-radius:15px;
  margin-bottom:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.12)
}

.status{font-weight:bold;margin:5px 0}
.meta{font-size:14px;color:#555;margin:3px 0}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center
}
.modal-box{
  background:#fff;
  padding:20px;
  border-radius:15px;
  width:92%;
  max-width:420px
}
.modal-box input{
  width:100%;
  padding:12px;
  margin-bottom:12px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px
}
</style>
</head>

<body>

<div class="header">
  <h2>RCEM ‚Äì Venues</h2>
  <button class="btn edit" onclick="logout()">Logout</button>
</div>

<div class="container">
  <button class="btn add" onclick="openModal()">+ Add Venue</button>
  <div id="venueList">Loading...</div>
</div>

<!-- MODAL -->
<div class="modal" id="modal">
  <div class="modal-box">
    <h3>Add / Edit Venue</h3>
    <input id="vname" placeholder="Venue Name">
    <input id="vlocation" placeholder="Address / Location">
    <input id="vcontact" placeholder="Mobile Number">
    <button class="btn edit" style="width:100%" onclick="saveVenue()">Save</button>
    <p style="text-align:center;cursor:pointer;margin-top:10px" onclick="closeModal()">Cancel</p>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDK3dqXZuWaH3gctxURdOZc_Q1UfioesaA",
  authDomain:"rcem-system.firebaseapp.com",
  projectId:"rcem-system",
  storageBucket:"rcem-system.appspot.com",
  messagingSenderId:"569730845486",
  appId:"1:569730845486:web:93e6c14ea47fdc6c89c8bf"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
let editId=null;

auth.onAuthStateChanged(u=>{
  if(!u) location.href="index.html";
});

function logout(){
  auth.signOut().then(()=>location.href="index.html");
}

function openModal(id=null,data=null){
  editId=id;
  modal.style.display="flex";
  vname.value=data?.venue_name||"";
  vlocation.value=data?.location||"";
  vcontact.value=data?.contact||"";
}

function closeModal(){
  modal.style.display="none";
}

function saveVenue(){
  const name=vname.value.trim();
  if(!name){alert("Venue name required");return;}

  const data={
    venue_name:name,
    location:vlocation.value,
    contact:vcontact.value,
    active:true
  };

  editId
    ? db.collection("venues").doc(editId).update(data)
    : db.collection("venues").add(data);

  closeModal();
}

function toggleStatus(id,val){
  db.collection("venues").doc(id).update({active:!val});
}

db.collection("venues").onSnapshot(snap=>{
  venueList.innerHTML="";
  snap.forEach(d=>{
    const v=d.data();
    venueList.innerHTML+=`
      <div class="card">
        <b>${v.venue_name}</b>
        <div class="status">Status: ${v.active?"Active":"Inactive"}</div>
        <div class="meta">üìû ${v.contact || "N/A"}</div>
        <div class="meta">üìç ${v.location || "N/A"}</div><br>
        <button class="btn edit" onclick='openModal("${d.id}",${JSON.stringify(v)})'>Edit</button>
        <button class="btn toggle" onclick='toggleStatus("${d.id}",${v.active})'>Toggle</button>
      </div>`;
  });
});
</script>

</body>
</html>
