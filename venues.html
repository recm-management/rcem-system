<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RCEM – Venues</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
header{background:#0d47a1;color:#fff;padding:15px;display:flex;justify-content:space-between}
button{padding:8px 12px;border:none;border-radius:5px;cursor:pointer}
.add{background:#2e7d32;color:#fff}
.edit{background:#1976d2;color:#fff}
.toggle{background:#f9a825;color:#000}
.delete{background:#d32f2f;color:#fff}
.card{background:#fff;margin:15px;padding:15px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;justify-content:center;align-items:center}
.box{background:#fff;padding:20px;border-radius:10px;width:90%;max-width:400px}
input{width:100%;padding:10px;margin:8px 0}
</style>
</head>

<body>

<header>
  <h3>RCEM – Venues</h3>
  <button onclick="logout()">Logout</button>
</header>

<div style="padding:15px">
  <button class="add" onclick="openAdd()">+ Add Venue</button>
</div>

<div id="list"></div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="box">
    <h3 id="title">Add Venue</h3>
    <input id="name" placeholder="Venue Name">
    <input id="location" placeholder="Location">
    <input id="contact" placeholder="Contact">
    <button class="edit" onclick="save()">Save</button>
    <button onclick="closeModal()">Cancel</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey: "AIzaSyDK3dqXZuWaH3gctxURdOZc_Q1UfioesaA",
  authDomain: "rcem-system.firebaseapp.com",
  projectId: "rcem-system"
});

const auth=firebase.auth();
const db=firebase.firestore();
let editId=null;

auth.onAuthStateChanged(u=>{if(!u)location="index.html";});

function logout(){auth.signOut().then(()=>location="index.html");}

function openAdd(){
  editId=null;
  document.getElementById("title").innerText="Add Venue";
  document.getElementById("modal").style.display="flex";
  name.value=location.value=contact.value="";
}

function openEdit(id,v){
  editId=id;
  title.innerText="Edit Venue";
  name.value=v.venue_name||"";
  location.value=v.location||"";
  contact.value=v.contact||"";
  modal.style.display="flex";
}

function closeModal(){modal.style.display="none";}

function save(){
  const data={
    venue_name:name.value,
    location:location.value,
    contact:contact.value,
    active:true
  };
  if(editId){
    db.collection("venues").doc(editId).update(data);
  }else{
    db.collection("venues").add(data);
  }
  closeModal();load();
}

function toggle(id,a){db.collection("venues").doc(id).update({active:!a});}

function del(id){
  if(confirm("Delete?"))db.collection("venues").doc(id).delete();
}

function load(){
  db.collection("venues").onSnapshot(s=>{
    list.innerHTML="";
    s.forEach(d=>{
      const v=d.data();
      list.innerHTML+=`
      <div class="card">
        <b>${v.venue_name||"Unnamed Venue"}</b><br>
        Status: ${v.active?"Active":"Inactive"}<br><br>
        <button class="edit" onclick='openEdit("${d.id}",${JSON.stringify(v)})'>Edit</button>
        <button class="toggle" onclick="toggle('${d.id}',${v.active})">Toggle</button>
        <button class="delete" onclick="del('${d.id}')">Delete</button>
      </div>`;
    });
  });
}
load();
</script>
</body>
</html>
/* LOGOUT */
function logout(){
  auth.signOut().then(()=>location.href="index.html");
}
</script>

</body>
</html>
