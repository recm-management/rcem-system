<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RCEM – Manage Venues</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif}
body{background:#f4f6f9}
.header{
  background:#0d47a1;color:#fff;padding:15px;
  display:flex;justify-content:space-between;align-items:center
}
.header h1{font-size:18px}
.logout{background:#d32f2f;border:none;color:#fff;padding:8px 12px;border-radius:5px}
.container{padding:15px;max-width:900px;margin:auto}

.add-btn{
  background:#2e7d32;color:#fff;border:none;
  padding:10px 15px;border-radius:6px;margin-bottom:15px
}

.card{
  background:#fff;border-radius:10px;padding:15px;
  margin-bottom:12px;box-shadow:0 4px 10px rgba(0,0,0,.1)
}
.card h3{margin-bottom:5px}
.status{font-size:14px;margin-bottom:10px}
.active{color:green}
.inactive{color:red}

.actions button{
  margin-right:5px;margin-top:5px;
  padding:6px 10px;border:none;border-radius:5px;font-size:13px
}
.edit{background:#1976d2;color:#fff}
.delete{background:#d32f2f;color:#fff}
.toggle{background:#f9a825;color:#000}

/* MODAL */
.modal{
  position:fixed;inset:0;background:rgba(0,0,0,.6);
  display:none;justify-content:center;align-items:center
}
.modal-box{
  background:#fff;width:100%;max-width:400px;
  padding:20px;border-radius:10px
}
.modal-box h2{text-align:center;margin-bottom:10px}
.modal-box input{
  width:100%;padding:10px;margin:6px 0;border:1px solid #ccc;border-radius:6px
}
.modal-box button{
  width:100%;padding:10px;margin-top:10px;
  border:none;border-radius:6px;background:#0d47a1;color:#fff
}
.close{text-align:center;margin-top:8px;font-size:13px;color:#777;cursor:pointer}
</style>
</head>

<body>

<div class="header">
  <h1>RCEM – Venues</h1>
  <button class="logout" onclick="logout()">Logout</button>
</div>

<div class="container">
  <button class="add-btn" onclick="openModal()">➕ Add Venue</button>
  <div id="venueList">Loading...</div>
</div>

<!-- ADD / EDIT MODAL -->
<div class="modal" id="venueModal">
  <div class="modal-box">
    <h2 id="modalTitle">Add Venue</h2>
    <input type="text" id="name" placeholder="Venue Name">
    <input type="text" id="location" placeholder="Location">
    <input type="text" id="contact" placeholder="Contact">
    <button onclick="saveVenue()">Save</button>
    <div class="close" onclick="closeModal()">Cancel</div>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig={
  apiKey:"AIzaSyDK3dqXZuWaH3gctxURdOZc_Q1UfioesaA",
  authDomain:"rcem-system.firebaseapp.com",
  projectId:"rcem-system",
  storageBucket:"rcem-system.appspot.com",
  messagingSenderId:"569730845486",
  appId:"1:569730845486:web:93e6c14ea47fdc6c89c8bf"
};
if(!firebase.apps.length){firebase.initializeApp(firebaseConfig)}
const auth=firebase.auth();
const db=firebase.firestore();

let editId=null;

/* AUTH PROTECT */
auth.onAuthStateChanged(u=>{
  if(!u) location.href="index.html";
});

/* LOAD VENUES */
db.collection("venues").onSnapshot(snap=>{
  const list=document.getElementById("venueList");
  list.innerHTML="";
  snap.forEach(doc=>{
    const v=doc.data();
    list.innerHTML+=`
    <div class="card">
      <h3>${v.name||"Unnamed Venue"}</h3>
      <div class="status ${v.active?"active":"inactive"}">
        Status: ${v.active?"Active":"Inactive"}
      </div>
      <div class="actions">
        <button class="edit" onclick="editVenue('${doc.id}','${v.name}','${v.location}','${v.contact}')">Edit</button>
        <button class="toggle" onclick="toggleVenue('${doc.id}',${v.active})">Toggle</button>
        <button class="delete" onclick="deleteVenue('${doc.id}')">Delete</button>
      </div>
    </div>`;
  });
});

/* MODAL */
function openModal(){
  editId=null;
  modalTitle.innerText="Add Venue";
  name.value=location.value=contact.value="";
  venueModal.style.display="flex";
}
function closeModal(){venueModal.style.display="none"}

/* SAVE */
function saveVenue(){
  const data={
    name:name.value,
    location:location.value,
    contact:contact.value,
    active:true
  };
  if(editId){
    db.collection("venues").doc(editId).update(data);
  }else{
    db.collection("venues").add(data);
  }
  closeModal();
}

/* EDIT */
function editVenue(id,n,l,c){
  editId=id;
  modalTitle.innerText="Edit Venue";
  name.value=n;location.value=l;contact.value=c;
  venueModal.style.display="flex";
}

/* DELETE */
function deleteVenue(id){
  if(confirm("Delete this venue?")){
    db.collection("venues").doc(id).delete();
  }
}

/* TOGGLE */
function toggleVenue(id,state){
  db.collection("venues").doc(id).update({active:!state});
}

/* LOGOUT */
function logout(){
  auth.signOut().then(()=>location.href="index.html");
}
</script>

</body>
</html>
