<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RCEM ‚Äì Assignments</title>

<style>
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:#f4f6f9}

.header{
  background:#0d47a1;
  color:#fff;
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
.back{cursor:pointer}

.top-actions{padding:16px}
.add-btn{
  padding:12px 22px;
  border:none;
  border-radius:25px;
  background:linear-gradient(45deg,#2e7d32,#43a047);
  color:#fff;
  font-size:15px;
  cursor:pointer
}

.container{padding:16px}

.card{
  background:#fff;
  border-radius:18px;
  padding:16px;
  margin-bottom:18px;
  box-shadow:0 8px 22px rgba(0,0,0,.12)
}

.title{
  font-size:17px;
  font-weight:bold;
  margin-bottom:10px
}

.program{
  background:#f5f7fb;
  padding:12px;
  border-radius:12px;
  margin-bottom:10px
}

.row{
  font-size:14px;
  margin:5px 0;
  color:#333
}

.badge{
  display:inline-block;
  margin-top:10px;
  padding:6px 14px;
  border-radius:18px;
  font-size:12px;
  color:#fff;
  background:#f9a825
}

.actions{
  display:flex;
  gap:10px;
  margin-top:10px
}

.edit-btn{
  padding:8px 14px;
  border:none;
  border-radius:14px;
  background:#1e88e5;
  color:#fff;
  cursor:pointer
}

.delete-btn{
  padding:8px 14px;
  border:none;
  border-radius:14px;
  background:#e53935;
  color:#fff;
  cursor:pointer
}
</style>
</head>

<body>

<div class="header">
  <div class="back" onclick="history.back()">‚Üê Back</div>
  <h3>Assignments</h3>
</div>

<div class="top-actions">
  <button class="add-btn" onclick="location.href='create-assignment.html'">
    + Create Assignment
  </button>
</div>

<div class="container" id="list">Loading...</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDK3dqXZuWaH3gctxURdOZc_Q1UfioesaA",
  authDomain:"rcem-system.firebaseapp.com",
  projectId:"rcem-system"
});

const db = firebase.firestore();
const list = document.getElementById("list");

/* LOAD ASSIGNMENTS */
db.collection("assignments")
.orderBy("created","desc")
.onSnapshot(snap=>{
  const grouped = {};
  snap.forEach(doc=>{
    const a = doc.data();
    if(!grouped[a.venue_name]) grouped[a.venue_name]=[];
    grouped[a.venue_name].push({id:doc.id,...a});
  });
  render(grouped);
});

function render(data){
  list.innerHTML="";
  Object.keys(data).forEach(venue=>{
    const programs = data[venue];

    list.innerHTML+=`
      <div class="card">
        <div class="title">${venue}</div>
        ${programs.map(p=>`
          <div class="program">
            <div class="row">üìÖ ${p.duty_date || "-"}</div>
            <div class="row">
              ‚è∞ ${p.shift==="day"?"‚òÄÔ∏è ‡¶¶‡¶ø‡¶®":p.shift==="night"?"üåô ‡¶∞‡¶æ‡¶§":"-"}
            </div>
            <div class="row">
              üë• ‡¶∏‡ßç‡¶ü‡¶æ‡¶´: ${p.assigned_count||0} / ${p.required_staff||0}
            </div>

            <span class="badge">${(p.status||"active").toUpperCase()}</span>

            <div class="actions">
              <button class="edit-btn"
                onclick="editAssignment('${p.id}')">
                ‚úèÔ∏è Edit
              </button>
              <button class="delete-btn"
                onclick="deleteAssignment('${p.id}')">
                üóë Delete
              </button>
            </div>
          </div>
        `).join("")}
      </div>
    `;
  });
}

/* EDIT ‚Äî ‚úÖ REAL EDIT */
function editAssignment(id){
  location.href = "create-assignment.html?edit=" + id;
}

/* DELETE */
function deleteAssignment(id){
  if(!confirm("‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?")) return;
  db.collection("assignments").doc(id).delete();
}
</script>

</body>
</html>
