<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RCEM Admin Dashboard</title>

<style>
body{margin:0;font-family:Arial;background:#f4f6f9}
.header{
  background:#0d47a1;
  color:#fff;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
.menu-btn{
  font-size:26px;
  cursor:pointer
}
.drawer{
  position:fixed;
  top:0;
  left:-260px;
  width:260px;
  height:100%;
  background:#fff;
  box-shadow:4px 0 15px rgba(0,0,0,.25);
  transition:.3s;
  z-index:1000;
  padding:15px
}
.drawer.open{left:0}
.drawer h4{margin-top:0}
.drawer a{
  display:block;
  padding:12px;
  margin-bottom:6px;
  border-radius:10px;
  color:#333;
  text-decoration:none;
  font-weight:bold
}
.drawer a:hover{background:#e3f2fd}
.logout{
  background:#d32f2f;
  color:#fff;
  text-align:center
}
.content{padding:20px}
.card{
  background:#fff;
  padding:16px;
  border-radius:16px;
  margin-bottom:15px;
  box-shadow:0 8px 20px rgba(0,0,0,.12)
}
.stat{font-size:22px;color:#0d47a1}
</style>
</head>

<body>

<div class="header">
  <span class="menu-btn" onclick="toggleMenu()">‚ò∞</span>
  <h3>RCEM Dashboard</h3>
</div>

<!-- SLIDE MENU -->
<div class="drawer" id="drawer">
  <h4>Logged in as</h4>
  <div id="loggedEmail" style="margin-bottom:15px;font-weight:bold"></div>

  <a id="menu_dashboard" href="admin.html">Dashboard</a>
  <a id="menu_assignments" href="assignments.html">Assignments</a>
  <a id="menu_staff" href="staff.html">Staff</a>
  <a id="menu_venues" href="venues.html">Venues</a>
  <a id="menu_accounts" href="accounts.html">Monthly Accounts</a>
  <a id="menu_users" href="admin-users.html">Admin Users</a>

  <a class="logout" href="#" onclick="logout()">Logout</a>
</div>

<!-- MAIN CONTENT -->
<div class="content">
  <div class="card">
    <div>Total Assignments</div>
    <div class="stat">12</div>
  </div>

  <div class="card">
    <div>Total Staff</div>
    <div class="stat">85</div>
  </div>

  <div class="card">
    <div>This Month Income</div>
    <div class="stat">‡ß≥ 1,25,000</div>
  </div>

  <div class="card">
    <div>Profit</div>
    <div class="stat">‡ß≥ 32,000</div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDK3dqXZuWaH3gctxURdOZc_Q1UfioesaA",
  authDomain:"rcem-system.firebaseapp.com",
  projectId:"rcem-system"
});

const auth=firebase.auth();
const db=firebase.firestore();

function toggleMenu(){
  drawer.classList.toggle("open");
}

function logout(){
  auth.signOut().then(()=>location.href="index.html");
}

/* üîê AUTH + PERMISSION CONTROL */
auth.onAuthStateChanged(async user=>{
  if(!user){
    location.href="index.html";
    return;
  }

  loggedEmail.innerText=user.email;

  const snap = await db.collection("users").doc(user.email).get();

  if(!snap.exists || snap.data().active !== true){
    alert(
      "‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶è‡¶á ‡¶Ö‡¶™‡¶∂‡¶®‡ßá ‡¶¢‡ßã‡¶ï‡¶æ‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶®‡ßá‡¶á\n\n" +
      "‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü: admin@rcem-system.com\n" +
      "‡¶´‡ßã‡¶®: +8801926627000"
    );
    await auth.signOut();
    location.href="index.html";
    return;
  }

  const p = snap.data().permissions || {};

  hide("menu_dashboard", p.dashboard);
  hide("menu_assignments", p.assignments);
  hide("menu_staff", p.staff);
  hide("menu_venues", p.venues);
  hide("menu_accounts", p.accounts);
  hide("menu_users", p.user_management);
});

function hide(id, allow){
  const el=document.getElementById(id);
  if(!el) return;
  if(!allow) el.style.display="none";
}
</script>

</body>
</html>
