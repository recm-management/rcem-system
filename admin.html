<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RCEM Admin Dashboard</title>

<style>
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}
body{background:#f4f6f9;overflow-x:hidden}

/* HEADER */
.header{
  background:linear-gradient(135deg,#0d47a1,#1976d2);
  color:#fff;
  padding:16px;
  display:flex;
  justify-content:space-between;
  align-items:center
}
.menu-btn{
  font-size:26px;
  cursor:pointer;
  user-select:none
}

/* OVERLAY */
.overlay{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  opacity:0;
  pointer-events:none;
  transition:.3s;
  z-index:10
}
.overlay.active{
  opacity:1;
  pointer-events:auto
}

/* SLIDE MENU */
.side-menu{
  position:fixed;
  top:0;right:-280px;
  width:260px;
  height:100%;
  background:#fff;
  box-shadow:-10px 0 25px rgba(0,0,0,.2);
  transition:.35s ease;
  z-index:11;
  display:flex;
  flex-direction:column
}
.side-menu.active{right:0}

/* USER INFO */
.user-box{
  padding:18px;
  background:#f1f5ff;
  border-bottom:1px solid #ddd
}
.user-box b{display:block;font-size:14px;color:#555}
.user-box span{font-size:13px;color:#0d47a1}

/* MENU ITEMS */
.menu{
  flex:1;
  padding:10px
}
.menu a{
  display:block;
  padding:14px 16px;
  margin-bottom:6px;
  border-radius:12px;
  color:#333;
  text-decoration:none;
  font-weight:500;
  transition:.25s
}
.menu a:hover{
  background:#e3f2fd;
  transform:translateX(6px)
}

/* LOGOUT */
.logout{
  margin:15px;
  padding:12px;
  border:none;
  border-radius:25px;
  background:#d32f2f;
  color:#fff;
  font-size:15px;
  cursor:pointer
}

/* DASHBOARD CONTENT */
.container{padding:18px}
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:15px
}
.card{
  background:#fff;
  padding:20px;
  border-radius:18px;
  box-shadow:0 8px 20px rgba(0,0,0,.12)
}
.card h3{font-size:15px;color:#666;margin-bottom:8px}
.card p{font-size:22px;font-weight:bold;color:#0d47a1}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <h2>RCEM Dashboard</h2>
  <div class="menu-btn" onclick="openMenu()">☰</div>
</div>

<!-- OVERLAY -->
<div class="overlay" id="overlay" onclick="closeMenu()"></div>

<!-- SIDE MENU -->
<div class="side-menu" id="sideMenu">
  <div class="user-box">
    <b>Logged in as</b>
    <span id="userEmail">Loading...</span>
  </div>

  <div class="menu">
    <a id="menu_dashboard" href="admin.html">Dashboard</a>
    <a id="menu_assignments" href="#">Assignments</a>
    <a id="menu_staff" href="staff.html">Staff</a>
    <a id="menu_venues" href="venues.html">Venues</a>
    <a id="menu_accounts" href="#">Monthly Accounts</a>
    <a id="menu_users" href="admin-users.html">Admin Users</a>
  </div>

  <button class="logout" onclick="logout()">Logout</button>
</div>

<!-- CONTENT -->
<div class="container">
  <div class="cards">
    <div class="card">
      <h3>Total Assignments</h3>
      <p>12</p>
    </div>
    <div class="card">
      <h3>Total Staff</h3>
      <p>85</p>
    </div>
    <div class="card">
      <h3>This Month Income</h3>
      <p>৳ 1,25,000</p>
    </div>
    <div class="card">
      <h3>Profit</h3>
      <p>৳ 32,000</p>
    </div>
  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyDK3dqXZuWaH3gctxURdOZc_Q1UfioesaA",
  authDomain:"rcem-system.firebaseapp.com",
  projectId:"rcem-system"
});

const auth=firebase.auth();
const db=firebase.firestore();

auth.onAuthStateChanged(async user=>{
  if(!user){
    location.href="index.html";
    return;
  }

  userEmail.innerText=user.email;

  const snap = await db.collection("users").doc(user.email).get();
  if(!snap.exists || snap.data().active !== true){
    alert("Unauthorized access");
    await auth.signOut();
    location.href="index.html";
    return;
  }

  const role = snap.data().role;
  if(role === "super_admin") return;

  const p = snap.data().permissions || {};

  hideMenu("menu_dashboard", p.dashboard);
  hideMenu("menu_assignments", p.assignments);
  hideMenu("menu_staff", p.staff);
  hideMenu("menu_venues", p.venues);
  hideMenu("menu_accounts", p.accounts);
  hideMenu("menu_users", p.user_management);
});

function hideMenu(id, allow){
  const el=document.getElementById(id);
  if(!el) return;
  if(!allow) el.style.display="none";
}

function openMenu(){
  sideMenu.classList.add("active");
  overlay.classList.add("active");
}
function closeMenu(){
  sideMenu.classList.remove("active");
  overlay.classList.remove("active");
}
function logout(){
  auth.signOut().then(()=>location.href="index.html");
}
</script>

</body>
</html>
